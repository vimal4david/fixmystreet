<dl>
  [% FOR pair IN contact.get_extra_metadata %]
    <dt>[% pair.key %]</dt> <dd>[% pair.value %]</dd>
  [% END %]
</dl>
<ul class="js-metadata-items">
  [% FOR meta IN contact.get_metadata_for_input %]
    <li class="js-metadata-item" data-index="[% loop.index %]">
        <label>
            Order:
            <input name="metadata[[% loop.index %]].order" type=text value="[% meta.order | html %]">
        </label>

        <label>
            Code:
            <input name="metadata[[% loop.index %]].code" type=text value="[% meta.code | html %]">
        </label>

        <label>
            Required:
            <input name="metadata[[% loop.index %]].required"  type=checkbox [% meta.required == 'true' ? 'checked' : '' %]>
        </label>

        <label>
            Variable:
            <input name="metadata[[% loop.index %]].variable"  type=checkbox [% meta.variable == 'true' ? 'checked' : '' %]>
        </label>

        <label>
            Description:
            <input name="metadata[[% loop.index %]].description" type=text value="[% meta.description | html %]">
        </label>

        <label>
            Hint:
            <input name="metadata[[% loop.index %]].datatype_description" type=text value="[% meta.datatype_description | html %]">
        </label>

        <label>
            Type:
            <select name="metadata[[% loop.index %]].datatype" class="js-metadata-item-type">
                <option value="string" [% meta.datatype == 'string' ? 'selected' : '' %]>String</option>
                <option value="singlevaluelist" [% meta.datatype == 'singlevaluelist' ? 'selected' : '' %]>List</option>
            </select>
        </label>

        <div class="js-metadata-options">
            Options<span class="js-hidden"> (ignored if type is 'String')</span>:
            <ul>
                [% outer_loop = loop %]
                [% values = meta.exists('values') ? meta.values : [] %]
                [% FOREACH option IN values.merge([{}]) %]
                [%# the .merge() call is so there's an empty one on the end %]
                    <li class="js-metadata-option [% IF loop.last %]js-hidden js-metadata-option-template[% END %]">
                        <label>
                            Key:
                            <input class="js-metadata-option-key" name="metadata[[% outer_loop.index %]].values[[% loop.index %]].key" type="text" value="[% option.key | html %]">
                        </label>
                        <label>
                            Name:
                            <input class="js-metadata-option-name" name="metadata[[% outer_loop.index %]].values[[% loop.index %]].name" type="text" value="[% option.name | html %]">
                        </label>
                        <button class="btn js-metadata-option-remove js-visible">Remove</button>
                    </li>
                [% END %]
                <li>
                    <button class="btn js-metadata-option-add js-visible">Add option</button>
                </li>
            </ul>
        </div>
  [%- END %]
</ul>
